// {{ ansible_managed }}
// https://icinga.com/docs/icinga-2/latest/doc/09-object-types/#dependency
/*
parent_host_name          Object name       Required. The parent host.
parent_service_name       Object name       Optional. The parent service. If omitted, this dependency object is treated as host dependency.
child_host_name           Object name       Required. The child host.
child_service_name        Object name       Optional. The child service. If omitted, this dependency object is treated as host dependency.
disable_checks            Boolean           Optional. Whether to disable checks when this dependency fails. Defaults to false.
disable_notifications     Boolean           Optional. Whether to disable notifications when this dependency fails. Defaults to true.
ignore_soft_states        Boolean           Optional. Whether to ignore soft states for the reachability calculation. Defaults to true.
period                    Object name       Optional. Time period object during which this dependency is enabled.
states                    Array             Optional. A list of state filters when this dependency should be OK. Defaults to [ OK, Warning ] for services and [ Up ] for hosts.
*/
{% set _attr = [
  'parent_host_name', 'parent_service_name',
  'child_host_name', 'child_service_name',
  'disable_checks', 'disable_notifications'
  'ignore_soft_states', 'period', 'states' ] -%}

{% if icinga2_dependencies %}
{%- for c, v in icinga2_dependencies.items() -%}
{%- if v['name'] is defined -%}
{%- set _name = '"%s"' % (v['name']) -%}
{%- set _v = v.pop('name') -%}
{%- else -%}
{%- set _name = '"%s"' % (c) -%}
{%- endif -%}

{% if v['description'] is defined %}
// {{ v['description'] }}
{% set _v = v.pop('description') %}
{% endif %}

object Dependency {{ _name }} {
{% for k, ve in icinga2_dependencies[c].items()  %}
{% if k in _attr  %}
{% if ve | type == 'str' %}
  {{ k }} = "{{ ve }}"
{% elif ve | type == 'list' %}
  {{ k }} = {{ "[ " + ", ".join(ve) + " ]" }}
{% elif ve | type == 'bool' %}
  {{ k }} = {{ ve | ternary( 'true', 'false') }}
{% endif %}
{% endif %}
{% endfor %}
}

{% endfor -%}

{% endif %}
