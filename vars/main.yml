---

monitoring_plugins_directory: /usr/lib/monitoring-plugins

icinga2_mariadb_build_packages: []
icinga2_mariadb_python_packages: []

icinga2_packages:
  - icinga2
  - icinga2-common

icinga2_requirements:
  - gnupg
  - ca-certificates

icinga2_remove_old_cert: false
icinga2_installed_version: ''
icinga2_needs_update: true

icinga2_downtime_system_name_internal: ''

icinga2_apply_service_default:
  ssh:
    import: generic-service
    check_command: ssh
    assign_where: '(host.address || host.address6) && host.vars.os == "Linux"'
  ping4:
    import: generic-service
    check_command: ping4
    assign_where: host.address
  ping6:
    import: generic-service
    check_command: ping6
    assign_where: host.address6
  load:
    import: generic-service
    check_command: load
    # Used by the ScheduledDowntime apply rule in `downtimes.conf`.
    extra_parameters: |
      if(host.vars.downtime) {
        vars.backup_downtime = host.vars.downtime
      }
    assign_where: 'host.vars.os == "Linux"'
  icinga:
    import: generic-service
    check_command: icinga
    assign_where: 'host.name == NodeName'
  procs:
    import: generic-service
    check_command: procs
    assign_where: 'host.name == NodeName'
  users:
    import: generic-service
    check_command: users
    extra_parameters: |
      vars.users_wgreater = 0
    assign_where: 'host.vars.os == "Linux"'
  apt:
    import: generic-service
    check_command: apt
    assign_where: 'host.vars.os == "Linux" && (host.vars.dist == "Debian" || host.vars.dist == "Ubuntu")'
  uptime:
    import: generic-service
    display_name: system uptime
    check_command: system_uptime
    assign_where: '"uptime" in host.vars.services'
  memory:
    import: generic-service
    display_name: system memory
    check_command: check_memory
    check_interval: '45s'
    retry_interval: '10s'
    assign_where: '"memory" in host.vars.services'
    ignore_where: 'host.vars.os == "Windows"'

icinga2_checkcommands_default:
  system_uptime:
    import: plugin-check-command
    command: '[ PluginDir + "/check_uptime.sh" ]'
  check_memory:
    import: plugin-check-command
    command: '[ PluginDir + "/check_mem" ]'

icinga2_timeperiod_default:
  never:
    display_name: Icinga2 never TimePeriod
    ranges: {}

  9to5:
    display_name: Icinga2 9to5 TimePeriod
    ranges:
      monday: "09:00-17:00"
      tuesday: "09:00-17:00"
      wednesday: "09:00-17:00"
      thursday: "09:00-17:00"
      friday: "09:00-17:00"
      saturday: "09:00-17:00"
      sunday: "09:00-17:00"

  24x7:
    display_name: Icinga2 24x7 TimePeriod
    ranges:
      monday: "00:00-24:00"
      tuesday: "00:00-24:00"
      wednesday: "00:00-24:00"
      thursday: "00:00-24:00"
      friday: "00:00-24:00"
      saturday: "00:00-24:00"
      sunday: "00:00-24:00"

icinga2_ido_default:
  type: mysql
  enabled: true
  user: 'icinga2_ido'
  password: 'icinga2_ido'
  host: '127.0.0.1'
  database: 'icinga2_ido'
  port: 3306
  socket: /run/mysqld.sock
  # Max age for ... Defaults to 0 (never)
  cleanup: {}
  mysql:
    schema_file: /usr/share/icinga2-ido-mysql/schema/mysql.sql
    schema_upgrade: /usr/share/icinga2-ido-mysql/schema/upgrade

icinga2_api_default:
  enabled: true
  accept_config: true
  accept_commands: true
  ticket_salt: TicketSalt
  user: {}

icinga2_filelogger_default:
  directory: /var/log/icinga2
  mainlog:
    severity: warning
    logfile: icinga2.log

icinga2_defaults_api:
  user:
    validate:
      password: validate
      permissions:
        - "status/query"

# https://icinga.com/docs/icinga-2/latest/doc/03-monitoring-basics/#apply-notifications-to-hosts-and-services
icinga2_defaults_notification_apply_rules:
  #
  host-mail:
    type: host
    import: mail-host-notification
    users: []
    user_groups: []
    interval: '2h'
    extra_parameters: |
      vars.notification_logtosyslog = true
    assign_where: "host.vars.notification.mail"
  #
  service-mail:
    type: service
    import: mail-service-notification
    users: []
    user_groups: []
    interval: '2h'
    extra_parameters: |
      vars.notification_logtosyslog = true

    assign_where: "host.vars.notification.mail"

icinga2_defaults_notification_templates:
  #
  generic-notification:
    command: "mail-service-notification"
    interval: 15m
    period: "24x7"
    states:
      - Warning
      - Critical
      - Unknown
    types:
      - Problem
      - Acknowledgement
      - Recovery
      - Custom
      - FlappingStart
      - FlappingEnd
      - DowntimeStart
      - DowntimeEnd
      - DowntimeRemoved
